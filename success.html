<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Procesando pedido...</title>
</head>
<body>
<script>
const params = new URLSearchParams(window.location.search);
const session_id = params.get('session_id');
if (session_id) {
  // Recupera el carrito y los datos de dirección del localStorage
  const carrito = localStorage.getItem('carrito');
  const direccion_calle = localStorage.getItem('direccion_calle') || '';
  const direccion_numero = localStorage.getItem('direccion_numero') || '';
  const direccion_colonia = localStorage.getItem('direccion_colonia') || '';
  const direccion_ciudad = localStorage.getItem('direccion_ciudad') || '';
  const direccion_estado = localStorage.getItem('direccion_estado') || '';
  const direccion_cp = localStorage.getItem('direccion_cp') || '';

  const form = document.createElement('form');
  form.method = 'POST';
  form.action = 'guardar_pedido.php?session_id=' + encodeURIComponent(session_id);

  function addField(name, value) {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = name;
    input.value = value;
    form.appendChild(input);
  }

  addField('carrito', carrito);
  addField('direccion_calle', direccion_calle);
  addField('direccion_numero', direccion_numero);
  addField('direccion_colonia', direccion_colonia);
  addField('direccion_ciudad', direccion_ciudad);
  addField('direccion_estado', direccion_estado);
  addField('direccion_cp', direccion_cp);

  document.body.appendChild(form);
  form.submit();
} else {
  document.write('<h1>¡Pago exitoso!</h1><p>No se pudo obtener el número de pedido.</p>');
}
</script>
</body>
</html>
